-- tb_uart_txd.vhd
library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.NUMERIC_STD.ALL;

entity tb_uart_txd is
end tb_uart_txd;

architecture sim of tb_uart_txd is

    -- DUT 포트와 연결될 신호
    signal rst_l   : std_logic := '0';
    signal clk100m : std_logic := '0';
    signal sw      : std_logic := '0';
    signal txd     : std_logic;

    constant CLK_PERIOD : time := 10 ns;  -- 100MHz (10ns 주기)

begin

    --------------------------------------------------------------------
    -- DUT 인스턴스
    --------------------------------------------------------------------
    uut : entity work.uart_txd
        port map (
            rst_l   => rst_l,
            clk100m => clk100m,
            sw      => sw,
            txd     => txd
        );

    --------------------------------------------------------------------
    -- 100MHz 클록 생성
    --------------------------------------------------------------------
    clk_gen : process
    begin
        while true loop
            clk100m <= '0';
            wait for CLK_PERIOD / 2;
            clk100m <= '1';
            wait for CLK_PERIOD / 2;
        end loop;
    end process;

    --------------------------------------------------------------------
    -- 리셋 + 스위치 자극
    --------------------------------------------------------------------
    stim_proc : process
    begin
        ----------------------------------------------------------------
        -- 1) 초기: 리셋 assert (low), 스위치 OFF
        ----------------------------------------------------------------
        rst_l <= '0';
        sw    <= '0';
        wait for 1 us;

        ----------------------------------------------------------------
        -- 2) 리셋 해제
        ----------------------------------------------------------------
        rst_l <= '1';

        -- PLL lock 및 내부 초기화 시간 여유
        wait for 50 us;

        ----------------------------------------------------------------
        -- 3) 스위치 1번째 클릭
        --    눌렀다 떼는 시간은 실제 버튼 느낌으로 수백 ?s 정도
        ----------------------------------------------------------------
        sw <= '1';
        wait for 1 ms;
        sw <= '0';

        -- 한 글자('A')가 전송될 시간을 기다려 줌
        -- 115200bps기준 1프레임 ≒ 87us, 여유있게 1ms 이상
        wait for 2 ms;

        ----------------------------------------------------------------
        -- 4) 스위치 2번째 클릭
        ----------------------------------------------------------------
        sw <= '1';
        wait for 1 ms;
        sw <= '0';

        wait for 2 ms;

        ----------------------------------------------------------------
        -- 5) 시뮬레이션 종료
        ----------------------------------------------------------------
        wait;
    end process;

end sim;
